#第01課 基本的動畫


#####執行結果:
![GitHub Logo](/screen/results01-1.png)


#####檔案放置方式:
```
   |___index.html
   |
   |___<css>
   |     |___main.css
   | 	 
   |___<js>
   |     |___MyCanvas.js  
   |     |___MySprite.js 
   |     |___SpriteImg.js
   |     
   |___<images>
         |___a_1.png        
```


#####檔案名稱: index.html
```html
<!doctype html> 
<html> 
<head> <meta charset="utf-8">
<title> 動畫測試 </title> 

<link rel="stylesheet" href="css/main.css"/>

<script src="js/MyCanvas.js"></script>
<script src="js/SpriteImg.js"></script>
<script src="js/MySprite.js"></script>

<script>
//==================
// 設定廣域變數
//==================
var myCanvas;   //畫布
var sprite=[];  //主角的陣列
var imgCnt=1;   //需載入圖片數


//====================================	
// 初始畫布物件(1個), 主角圖片物件(1個)
//====================================
function init(){
    // 產生<畫布>物件, 傳入:(1)畫布物件, (2)背景色
    myCanvas=new MyCanvas("myCanvas", "#a0a0a0");	
	
    // SpriteImg<主角圖片>物件可直接使用 myCanvas<畫布>		
    SpriteImg.prototype=myCanvas;
	
    // MySprite<主角>物件可直接使用SpriteImg<主角圖片>物件		
    // 傳入:(1)主角圖片, (2)每個影格寬, (3)每個影格高, (4)每個完整動作有幾個影格, (5)載完圖片後的callback函式
    MySprite.prototype=new SpriteImg('images/a_1.png', 32, 48, 4, imageLoaded);
}


//===============================
// 檢查動畫使用的圖片是否均已載入
//===============================
function imageLoaded(){
    imgCnt--;
	
    //------------------
    // 如果圖片已載入完成
    //------------------
    if(imgCnt==0){		
        // 建立多隻主角	
        sprite.push(new MySprite(100, 100, 0, 'normal'));
        sprite.push(new MySprite(500, 100, 1, 'fast'));
        sprite.push(new MySprite(100, 400, 2, 'slow'));
        sprite.push(new MySprite(500, 400, 3, 'normal'));		
		
        //-------------------------
        // 每隔一段時間執行主要流程
        //-------------------------	
        setInterval(main, 30);		
    }
}


//================
// 動畫主要流程
//================
function main(){	
    //清除畫布
    myCanvas.clearScreen();
	
    //畫主角
    for(var i=0; i<sprite.length; i++){
        sprite[i].walk();
    }
}
</script>

</head> 


<body onLoad="init()"> 
    <div align="center"> 
        <canvas id="myCanvas" width="800" height="600"> 
        </canvas> 
    </div> 
</body>

</html>
```



#####檔案名稱: main.css
```css
@charset "utf-8";
```



#####檔案名稱: MyCanvas.js
```js
//========================================
// 將<畫布>包裝在一個建構元函式中
//========================================
function MyCanvas(canvasId, background){
    this.canvas=document.getElementById(canvasId);
    this.context=this.canvas.getContext("2d");
	
    // 取得繪圖介面
    this.getContext=function(){
        return this.context;
    }
	
    // 清除畫布
    this.clearScreen=function(){
        this.context.fillStyle = background;
        this.context.fillRect (0, 0, this.canvas.width, this.canvas.height);
    }			
}
```


#####檔案名稱: SpriteImg.js
```js
//==================================
// 將<主角圖片>包裝在建構元函式中
//==================================
function SpriteImg(imageName, width, height, numOfFramePerDirection, callback){
    // 主角圖片	
    this.image=new Image();
    this.image.src=imageName;
	
    // 主角的寬及高	
    this.w=width;
    this.h=height;
	
    // 主角的圖片每個方向有幾張影格
    this.numOfFramePerDirection=numOfFramePerDirection;
	
    //如果圖片載入完成, 執行imageLoaded函式
    this.image.onload=function(event){		
        callback();
    }
}
```


#####檔案名稱: MySprite.js
```js
//=================================
// 將<主角>包裝在建構元函式中
//=================================
function MySprite(x, y, direction, speed){
    // 主角改變影格的時差
    var normalSpeed=150;
    var fastSpeed=100;
    var slowSpeed=200;	
	
    // 主角每步的距離
    var distance=4;
	
    // 初始座標, 方向及速度
    this.posX=x;
    this.posY=y;
    this.direction=direction;			
    this.speed=speed;

    //主角的影格編號
    this.step=0;    
	
    //上一次切換影格的時間
    this.lastMsec=0;   
	
    //----------------------------------
    // 在大圖切一塊影格 [w, h], 畫在畫布上
    //----------------------------------
    this.walk=function(){    	
        this.getContext().drawImage(this.image, this.step*this.w, this.direction*this.h, this.w, this.h, this.posX, this.posY, this.w, this.h);
	
        // 取得現在時間
        var thisMsec=(new Date()).getTime();
		
        // 如果達到切換時間
        var duration=0;
        if(this.speed=='normal'){duration=normalSpeed;}
        if(this.speed=='fast'){duration=fastSpeed;}
        if(this.speed=='slow'){duration=slowSpeed;}
		
        if(Math.abs(thisMsec - this.lastMsec) > duration){
            // 向下
            if(this.direction==0){
                this.posX+=0;
                this.posY+=distance;
            }
			
            // 向左
            if(this.direction==1){
                this.posX-=distance;
                this.posY-=0;
            }
			
            // 向右
            if(this.direction==2){
                this.posX+=distance;
                this.posY-=0;
            }
			
            // 向上
            if(this.direction==3){
                this.posX+=0;
                this.posY-=distance;
            }			
			
            //切換下一影格
            this.step++;
            this.step%=this.numOfFramePerDirection;
            this.lastMsec=thisMsec;
        }
    }
	
	
    //----------
    // 設定方向
    //----------
    this.setDirection=function(direction){
        if(direction=='down'){this.direction=0;}
        if(direction=='left'){this.direction=1;}	
        if(direction=='right'){this.direction=2;}	
        if(direction=='up'){this.direction=3;}		
    }
}
```
